{% extends "layout.html" %}


{% block title %}
Index
{% endblock %}


{% block headline %}
{{ title }}
{% endblock %}



{% block content %}
<img src="/static/123.jpg?202107291601" class="img-fluid" alt="Responsive image"/>
<h4 class="mb-1 " id="msg">{{message}}</h4>

<!-- Vue.js container -->
<div id="app" class="m-3">
    <mycomp/>
</div>


<!-- mycomp's template -->
{% raw %}

<script type="text/x-template" id="mycomp-template">
<!-- ↓以下は⇒を参照　https://blog1.mammb.com/entry/2019/12/11/090000 -->   
<!-- 但し、↑参照HPでは<form>~</form>で括っているが、1行目を<div class="form-group"> -->
  <!-- 最終行を</div>  で括らないと、SPAとして動作しない（index/?file=）となってしまう。 -->
<div><!-- ←　この最初のdivは、必要！！・・でないと、モーダルダイアログyear_month Dialogが出てこない -->
 
  <div class="form-group">
    <label >{{title_msg}}</label>
    <button type="submit"  class="btn btn-primary" v-on:click="preDl_file">ファイル受信</button>
            </div>
<!-- Error message  -->
<!-- <div class="card" >
  <div class="card-body">
  <img class="card-img"  src="/static/1.png">
  </div>
</div> -->
    <label>👇以下「エラーメッセージ」です</label>
      　<label>(※総括表ファイルの「読み込み不可　エラーメッセージ」シートにも書き込まれています)</label>
    <ul class="list-group border-left border-right border-bottom list-unstyled">
      <template v-for="items in errData">
        <li class="border-top" >
          {{items[0]}}<!-- {{url_for('static', filename='123.jpg')}} -->
        </li>
        <template v-for="item in items.slice(1)"><!--https://maku77.github.io/js/array/slice.html  -->
            <ul>
              <!-- {% set jpg_url={{url_for('static', filename='123.jpg')}} %} -->
              
              <!--↓bootstrapの「tooltip」をリストに使う時　参照⇒https://blog.capilano-fw.com/?p=4773   -->
              <!-- ↓　但し、「tooltip」の「title=」属性を上記HPのように「data-original-title」としなくてもうごいてくれた -->
              <!-- <li class="list-group-item-sm list-unstyled ml-4 small border-top-0 border-left-0 border-right-0" 
                data-toggle="tooltip" data-html="true" 
                v-bind:data-original-title="'【'+item[0]+'】'+item[1]+'<br><img src=&quot;&#39;{{url_for('static', filename='123.jpg')}}&#39;&quot; class=&quot;img-fluid&quot; alt=&quot;Responsive image&quot;>'"> -->
                <!-- <li class="list-group-item-sm list-unstyled ml-4 small border-top-0 border-left-0 border-right-0" 
                data-toggle="tooltip" data-html="true" 
                v-bind:data-original-title="'【'+item[0]+'】'+item[1]+'<br><img src=&quot;/static/123.jpg&quot;>'">  --> 
                <!-- <li class="list-group-item-sm list-unstyled ml-4 small border-top-0 border-left-0 border-right-0" 
                data-toggle="tooltip" data-html="true" 
                v-bind:data-original-title="'【'+item[0]+'】'+item[1]+'<br><img src=&quot;'/static/'+item[0]+'.jpg?202107291602'&quot; &#47;>'"> -->  
                <li class="list-group-item-sm list-unstyled ml-4 small border-top-0 border-left-0 border-right-0" 
                data-toggle="tooltip" data-html="true" 
                v-bind:title="'【'+item[0]+'】'+item[1]+'<br><img src=&quot;/static/'+item[0]+'.jpg?202107291603&quot; />'"> 
                <!--↑「v-bind:title=」・・・vueディレクティブ内の属性に、変数を使う時に「v-bind:」は必要　参照⇒ 『Python フレームワークFlaskで学ぶ Webアプリケーションのしくみとつくり方 [掌田津耶乃]』P204  -->
                <template v-if="item[0]==''">
                  {{''}}
                  
                </template>  
                <template v-else>
                  
                  {{'【'+item[0]+'】'+item[1]}}
                </template> 
              </li>
            <ul>  
        </template>
      </template>
    </ul> 



</div><!-- ←　この最後のdivは、必要！！・・でないと、モーダルダイアログyear_month Dialogが出てこない -->
<!-- ↑以上は⇒を参照　https://blog1.mammb.com/entry/2019/12/11/090000 -->    
</script>
{% endraw %}

<!-- ******************** -->
<!-- * Vue.js Component Script * -->
<!-- ******************** -->
<script>

  
//database view

Vue.component('mycomp', {
    template: '#mycomp-template',
    data:function(){

        return{  
                title_msg:'download 試行開始',
                downloadFileName: '',  //←この一行のdownloadFileという変数は
                errData:null,
                //ajax通信するときに用意しておかなければならない⇒を参照　http://tech.aainc.co.jp/archives/10714
                jpg_url:null,
                
              }
    },
    methods:{
      preDl_file:function(e){
        /* e.preventDefault(); */
        /* let formData= new FormData(); */
        /* let data={downloadFile:self.downloadFile} */
        /* let blobData= new Blob(); */
        let self=this;
        $.ajax({//←テキストデータをバックエンドのpython側から戻り値として
          //送ってもらう時は、axiosよりも、なぜか$.ajaxのほうが成功する
        method: "GET",
        url: "/preget",

        success:function(data1) {
          self.errData=data1;
          Vue.nextTick(() => {

            $('[data-toggle="tooltip').tooltip();
            /* title() {
            return $(this).attr('title');
            } */
            })
        },
        error:function () {
          self.title_msg='送信途中で失敗';
        }
      });
      },
    },
    /* ↓　動的に「tooltip」を作成するために「watch」は必要
    参照⇒https://blog.capilano-fw.com/?p=4773
    但し、上記HPのサンプルにあった「mounted」「title()」は、省略しても動いてくれた */
           /*  watch: {
              item:function() {
              

                }
            }, */
            /* mounted() {
                this.errData = data1;
            } */

});
//start Vue.
new Vue({
    el:'#app',
});
</script>

{% endblock %}




{% block footer %}
copyright 2020 shim tko.
{% endblock %}
